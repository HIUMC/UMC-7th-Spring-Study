# 회원 가입

# 회원 가입 폼 객체

---

- 영한 : “회원 가입 폼을 작성해야 하니까 폼 객체를 만들어야겠죠~”
- DTO을 꼭 써야 하는 이유?
    - [뒤에서 설명](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac.md)

```java
package jpabook.jpashop.controller;

import lombok.Getter;
import lombok.Setter;

import jakarta.validation.constraints.NotEmpty;

@Getter @Setter
public class MemberForm {

    @NotEmpty(message = "회원 이름은 필수입니다")
    private String name;

    private String city;
    private String street;
    private String zipcode;
}
```

- jakarta.validation 라이브러리와 `@NotEmpty` 란?
    - 뒤에서 설명 : [@Valid](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac.md)

# `@GetMapping("/members/new")`

---

- GET : 폼 화면을 열어보는 것

```java
@Controller
@RequiredArgsConstructor
public class MemberController {

    private final MemberService memberService;

    @GetMapping("/members/new")
    public String createForm(Model model) {
        model.addAttribute("memberForm", new MemberForm());
        return "members/createMemberForm";
    }
}
```

## createMemberForm.html

---

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<style>
    .fieldError {
        border-color: #bd2130;
    }
</style>
<body>

<div class="container">
    <div th:replace="fragments/bodyHeader :: bodyHeader"/>

    <form role="form" action="/members/new" th:object="${memberForm}" method="post">
        <div class="form-group">
            <label th:for="name">이름</label>
            <input type="text" th:field="*{name}" class="form-control"
                   placeholder="이름을 입력하세요"
                   th:class="${#fields.hasErrors('name')}? 'form-control fieldError' : 'form-control'">
            <p th:if="${#fields.hasErrors('name')}"
               th:errors="*{name}">Incorrect date</p>
        </div>
        <div class="form-group">
            <label th:for="city">도시</label>
            <input type="text" th:field="*{city}" class="form-control"
                   placeholder="도시를 입력하세요">
        </div>
        <div class="form-group">
            <label th:for="street">거리</label>
            <input type="text" th:field="*{street}" class="form-control"
                   placeholder="거리를 입력하세요">
        </div>
        <div class="form-group">
            <label th:for="zipcode">우편번호</label>
            <input type="text" th:field="*{zipcode}" class="form-control"
                   placeholder="우편번호를 입력하세요">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    <br/>
    <div th:replace="fragments/footer :: footer" />
</div> <!-- /container -->

</body>
</html>
```

- `th:` 가 붙은 것들은 모두 타임리프 문법
- `th:field="*{city}"` 는 `id = "city" name = "city"` 로 바꿔쓸 수 있다.
- 페이지 소스 보기에서 볼 수 있는 것처럼, id와 name 다 받는게 관례
    - 타임리프 문법과 * (object(memberForm) 참조)로 줄일 수 있다.

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image.png)

## 첫번째 필드가 뭔가 복잡한데요?

```html
<div class="form-group">
    <label th:for="name">이름</label>
    <input type="text" th:field="*{name}" class="form-control"
           placeholder="이름을 입력하세요"
           th:class="${#fields.hasErrors('name')}? 'form-control fieldError' : 'form-control'">
    <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Incorrect date</p>
</div>
```

- PostMapping 메서드와 관련

# `@PostMapping(”/members/new”)`

---

- POST : 데이터를 실제 등록

```java
@PostMapping("/members/new")
public String create(@Valid MemberForm form) {

    Address address = new Address(form.getCity(), form.getStreet(), form.getZipcode());

    Member member = new Member();
    member.setName(form.getName());
    member.setAddress(address);

    memberService.join(member);
    return "redirect:/";
}
```

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/9671c2af-be9c-4bd2-9c37-8a123c3def80.png)

쿼리 잘 날라가는 걸 확인 가능. **단, 이름이 반드시 포함됐을 때만.**

## `@Valid`

---

```java
    @PostMapping("/members/new")
    public String create(@Valid MemberForm form) {
			...
    }
```

- `@Valid` 를 보고 스프링이 jakarta.validation 기능을 쓰는구나 알아차림

```java
import jakarta.validation.constraints.NotEmpty;

@Controller
@RequiredArgsConstructor
public class MemberController {

    @NotEmpty(message = "회원 이름은 필수입니다")
    private String name;
    
    ...
}
```

- `@NotEmpty` 타고 가서

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image%201.png)

- 요 과녁 표시 누르면

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image%202.png)

- 기능이 참 많은걸 확인 가능.

### 이름을 빼고 넣어보자

---

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image%203.png)

- Valid 오류가 뜨는 것을 확인할 수 있다.

## `BindingResult`

---

```java
@PostMapping("/members/new")
public String create(@Valid MemberForm form, BindingResult reuslt) {

    if (reuslt.hasErrors()) {
        return "members/createMemberForm";
    }

    Address address = new Address(form.getCity(), form.getStreet(), form.getZipcode());

    Member member = new Member();
    member.setName(form.getName());
    member.setAddress(address);

    memberService.join(member);
    return "redirect:/";
}
```

- 만약 오류가 발생하면, result에 오류가 담긴다.
- thymeleaf와 spring은 integration이 잘돼있다.

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image%204.png)

```html
<div class="form-group">
    <label th:for="name">이름</label>
    <input type="text" th:field="*{name}" class="form-control"
           placeholder="이름을 입력하세요"
           th:class="${#fields.hasErrors('name')}? 'form-control fieldError' : 'form-control'">
    <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Incorrect date</p>
</div>
```

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image%205.png)

- 잘 동작하는 것 확인

# MemberForm(DTO)을 꼭 써야 하는 이유?

---

- **MemberForm은 DTO : Data Transfer Object 이다.**
- **결론 : 도메인(Entity)과 화면의 분리**
    - `MemberForm`은 화면(Form)과 도메인(Entity)의 역할을 분리하여 **검증 기준, 데이터 구조, 로직을 분리**하는 데 도움을 준다.

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image%206.png)

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image%207.png)

- 영한 : “그래서 폼을 사용해서 컨트롤러에서 정제-꼭 필요한 데이터만 채워서 넘기시는 것을 권장합니다. 실무는 이렇게 단순한 폼 화면일 수가 없음!”

![image.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20146d916bc5a880b6a212d8bffcf2ffac/image%208.png)

---

- validation은 여기에서만 사례로 보여주고 뒷 강의에선 생략